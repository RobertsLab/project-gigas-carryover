---
title: "C. gigas growth - lifestage carryover project" 
author: "AS Huffmyer"
date: '2024'
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_depth: 6
    toc_float: yes
  pdf_document:
    keep_tex: yes
editor_options: 
  chunk_output_type: console
---

# Setup  

Set up workspace, set options, and load required packages.    
```{r}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Load libraries 

```{r}
library(tidyverse)
library(ggplot2)
```

# Read in data 

```{r}
growth<-read_csv("lifestage_carryover/data/size/gigas-lengths.csv")

growth<-growth%>%
  rename(tag=`tag...1`)%>%
  select(tag, `life-stage`, `init-treat`, label, month, length)%>%
  rename(lifestage=`life-stage`, treatment=`init-treat`)

growth$month<-factor(growth$month, levels=c("Oct", "Nov", "Jan"))
```

# Look at data for whole population together  

## Plot growth over months for each life stage and treatment 

Plot as box plot
```{r}
plot<-growth%>%
  
  ggplot(aes(color=treatment, x=month, y=length))+
  geom_boxplot()+
  facet_grid(~lifestage)+
  ylab("Mean Length (cm)")+
  xlab("Month")+
  scale_color_manual(values=c("darkgray", "darkred"), name="Treatment", labels=c("Control", "Treatment"))+
  theme_classic()+
  theme(
    text=element_text(size=12, color="black")
  );plot

ggsave(plot=plot, "lifestage_carryover/output/size/mean_lengths_box.png", width=7, height=4)
```

Plot as mean +- standard error for all.  
```{r}
plot2<-growth%>%
  group_by(treatment, month, lifestage)%>%
  summarise(mean=mean(length, na.rm=TRUE), se=sd(length, na.rm=TRUE)/sqrt(length(length)))%>%
  
  ggplot(aes(color=treatment, x=month, y=mean))+
  geom_point(aes(group=interaction(treatment, lifestage)), position=position_dodge(0.3), size=1)+
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=0, position=position_dodge(0.3), linewidth=0.75)+
  geom_line(aes(group=treatment), position=position_dodge(0.3), linewidth=1)+
  facet_grid(~lifestage)+
  ylab("Mean Length (cm)")+
  xlab("Month")+
  scale_color_manual(values=c("darkgray", "darkred"), name="Treatment", labels=c("Control", "Treatment"))+
  theme_classic()+
  theme(
    text=element_text(size=12, color="black")
  );plot2

ggsave(plot=plot2, "lifestage_carryover/output/size/mean_lengths.png", width=7, height=4)
```

## Run model

```{r}
model<-aov(length~lifestage*month*treatment, data=growth)
summary(model)

```

Significant lifestage and month effects. No significant treatment effects. 

# Run plot and model by tag 

Calculate mean size at each month for each replicate and calculate % growth (change/original).  

```{r}
replicates<-growth%>%
  group_by(treatment, month, lifestage, tag)%>%
  summarise(mean=mean(length, na.rm=TRUE))%>%
  pivot_wider(names_from=month, values_from=mean)%>%
  mutate(perc_growth_Nov=((Nov-Oct)/Oct)*100)%>%
  mutate(perc_growth_Jan=((Jan-Oct)/Oct)*100)
```

## Plot growth for adult animals sampled in November

```{r}
plot3<-replicates%>%
  select(treatment, lifestage, tag, perc_growth_Nov)%>%
  drop_na()%>%
  droplevels()%>%
  
  ggplot(aes(color=treatment, x=treatment, y=perc_growth_Nov, shape=tag))+
  geom_line(aes(group=tag), color="black")+
  geom_point(aes(group=interaction(treatment, lifestage)), position=position_dodge(0.3), size=5)+
  ylab("% growth")+
  xlab("Treatment")+
  scale_color_manual(values=c("darkgray", "darkred"), name="Treatment", labels=c("Control", "Treatment"))+
  scale_shape_manual(name="Family", values=c(15, 16, 17, 18))+
  ggtitle("Adults: Oct-Nov Growth")+
  theme_classic()+
  theme(
    text=element_text(size=12, color="black")
  );plot3

ggsave(plot=plot3, "lifestage_carryover/output/size/adults_Nov_percent_growth.png", width=4, height=4)
```

Test for effect of treatment. 
```{r}
model<-replicates%>%
  select(treatment, lifestage, tag, perc_growth_Nov)%>%
  drop_na()%>%
  droplevels()%>%
  
  aov(perc_growth_Nov~treatment, data=.)

summary(model)
```
Effect of treatment just barely not significant (P=0.088). 

            Df Sum Sq Mean Sq F value Pr(>F)  
treatment    1  8.358   8.358   4.132 0.0883 .
Residuals    6 12.137   2.023    

## Plot growth for animals measured in January 

Adults
```{r}
plot4<-replicates%>%
  select(treatment, lifestage, tag, perc_growth_Jan)%>%
  filter(lifestage=="adult")%>%
  drop_na()%>%
  droplevels()%>%
  
  ggplot(aes(color=treatment, x=treatment, y=perc_growth_Jan, shape=tag))+
  geom_line(aes(group=tag), color="black")+
  geom_point(aes(group=interaction(treatment, lifestage)), position=position_dodge(0.3), size=5)+
  ylab("% growth")+
  xlab("Treatment")+
  scale_color_manual(values=c("darkgray", "darkred"), name="Treatment", labels=c("Control", "Treatment"))+
  ylim(-7, 3)+
  scale_shape_manual(name="Family", values=c(15, 16, 17, 18))+
  ggtitle("Adults: Oct-Jan Growth")+
  theme_classic()+
  theme(
    text=element_text(size=12, color="black")
  );plot4

ggsave(plot=plot4, "lifestage_carryover/output/size/adults_Jan_percent_growth.png", width=4, height=4)
```

Juveniles
```{r}
plot5<-replicates%>%
  select(treatment, lifestage, tag, perc_growth_Jan)%>%
  filter(lifestage=="juvenile")%>%
  drop_na()%>%
  droplevels()%>%
  
  ggplot(aes(color=treatment, x=treatment, y=perc_growth_Jan, shape=tag))+
  geom_point(aes(group=interaction(treatment, lifestage)), position=position_dodge(0.3), size=5)+
  ylab("% growth")+
  xlab("Treatment")+
  scale_color_manual(values=c("darkgray", "darkred"), name="Treatment", labels=c("Control", "Treatment"))+
  scale_shape_manual(name="Replicate", values=c(15, 16, 17, 18))+
  ggtitle("Juvenile: Oct-Jan Growth")+
  theme_classic()+
  ylim(0,20)+
  theme(
    text=element_text(size=12, color="black")
  );plot5

ggsave(plot=plot5, "lifestage_carryover/output/size/juvenile_Jan_percent_growth.png", width=4, height=4)
```

Seed

```{r}
plot6<-replicates%>%
  select(treatment, lifestage, tag, perc_growth_Jan)%>%
  filter(lifestage=="seed")%>%
  drop_na()%>%
  droplevels()%>%
  
  ggplot(aes(color=treatment, x=treatment, y=perc_growth_Jan, shape=tag))+
  #geom_line(aes(group=tag), color="black")+
  geom_point(aes(group=interaction(treatment, lifestage)), position=position_dodge(0.3), size=5)+
  ylab("% growth")+
  xlab("Treatment")+
  scale_color_manual(values=c("darkgray", "darkred"), name="Treatment", labels=c("Control", "Treatment"))+
  scale_shape_manual(name="Replicate", values=c(15, 16, 17, 18))+
  ggtitle("Seed: Oct-Jan Growth")+
  theme_classic()+
  ylim(0,250)+
  theme(
    text=element_text(size=12, color="black")
  );plot6

ggsave(plot=plot6, "lifestage_carryover/output/size/seed_Jan_percent_growth.png", width=4, height=4)
```

Spat

```{r}
plot7<-replicates%>%
  select(treatment, lifestage, tag, perc_growth_Jan)%>%
  filter(lifestage=="spat")%>%
  drop_na()%>%
  droplevels()%>%
  
  ggplot(aes(color=treatment, x=treatment, y=perc_growth_Jan, shape=tag))+
  #geom_line(aes(group=tag), color="black")+
  geom_point(aes(group=interaction(treatment, lifestage)), position=position_dodge(0.3), size=5)+
  ylab("% growth")+
  xlab("Treatment")+
  scale_color_manual(values=c("darkgray", "darkred"), name="Treatment", labels=c("Control", "Treatment"))+
  scale_shape_manual(name="Replicate", values=c(15, 16, 17, 18))+
  ggtitle("Spat: Oct-Jan Growth")+
  theme_classic()+
  ylim(0,150)+
  theme(
    text=element_text(size=12, color="black")
  );plot7

ggsave(plot=plot7, "lifestage_carryover/output/size/spat_Jan_percent_growth.png", width=4, height=4)
```


## Test for effect of treatment by lifestage 

January all stages 

```{r}
model<-replicates%>%
  select(treatment, lifestage, tag, perc_growth_Jan)%>%
  drop_na()%>%
  droplevels()%>%
  
  aov(perc_growth_Jan~treatment*lifestage, data=.)

summary(model)
```

Effect of lifestage, no treatment effects. 

                    Df Sum Sq Mean Sq F value   Pr(>F)    
treatment            1      1       1   0.015    0.904    
lifestage            3  96056   32019 325.275 3.54e-13 ***
treatment:lifestage  3    363     121   1.231    0.335    
Residuals           14   1378      98   

# Plot percent growth in only ambient treatment 

Plot growth rates between lifestages. 

Calculate growth as % growth per day. 

```{r}
replicates<-replicates%>%
  mutate(perc_growth_day=perc_growth_Jan/60)
```


```{r}
plot8<-replicates%>%
  select(treatment, lifestage, tag, perc_growth_day)%>%
  #filter(treatment=="control")%>%
  drop_na()%>%
  droplevels()%>%
  
  ggplot(aes(x=lifestage, y=perc_growth_day))+
  geom_point()+
  geom_boxplot(fill=NA)+
  ylab("% Winter Growth per Day")+
  xlab("Life Stage \nLength")+
  scale_x_discrete(limits=c("spat", "seed", "juvenile", "adult"), labels=c("Spat \n<10mm", "Seed \n15-25mm", "Juvenile \n30-40mm", "Adult \n>45mm"))+
  theme_classic()+
  theme(
    text=element_text(size=12, color="black"), 
    axis.text=element_text(size=12, color="black"), 
    axis.title=element_text(size=14, color="black", face="bold")
  );plot8

ggsave(plot=plot8, "lifestage_carryover/output/size/lifestage_growth.png", width=5, height=5)
```

Calculate size of each lifestage 
```{r}
avg_size<-replicates%>%
  select(lifestage, Jan)%>%
  group_by(lifestage)%>%
  summarise(mean=mean(Jan, na.rm=TRUE));avg_size
```

```{r}
avg_size<-replicates%>%
  select(lifestage, tag, Jan)%>%
  filter(lifestage=="adult")%>%
  group_by(tag)%>%
  summarise(mean=mean(Jan, na.rm=TRUE));avg_size
```
